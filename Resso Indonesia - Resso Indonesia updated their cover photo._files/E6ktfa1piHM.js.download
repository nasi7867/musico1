if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }/*FB_PKG_DELIM*/

__d("MTouchChannelManager",["Bootloader","MChannelManager","Run","gkx","onAfterDisplay"],(function(a,b,c,d,e,f,g){var h=!1;function a(a){a===void 0&&(a=!1);if(h)return;h=!0;c("MChannelManager").addListener(c("MChannelManager").CHANNEL_MESSAGE,function(a){return c("Bootloader").loadModules(["MTouchChannelPayloadRouter"],function(b){return b.route(a)},"MTouchChannelManager")});!a&&c("gkx")("676783")?c("gkx")("842146")?d("Run").onAfterLoad(c("MChannelManager").startChannel):c("onAfterDisplay")(c("MChannelManager").startChannel):c("MChannelManager").startChannel()}g.initialize=a}),98);
__d("MPresenceIcon",["DOM","MLegacyDataStore","MRequest","MURI","Stratcom","Visibility","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){var g=1,h=2,i=6e4,j=null;function k(){var a=b("DOM").scry(document.body,"i","presence-icon"),c=[];for(var d=0,e=a.length;d<e;++d){var f=b("MLegacyDataStore").get(a[d]);f.userid&&!c[f.userid]&&(c[f.userid]=1)}if(c.length==0||b("Visibility").isHidden()){window.clearTimeout(j);j=b("setTimeoutAcrossTransitions")(k,i);return}f=new(b("MURI"))("/chat/presence_icon.php").toString();d=new(b("MRequest"))(f).setData({ids:Object.keys(c)}).setIgnoreErrors(!0);d.listen("done",function(e){for(var c=0,d=a.length;c<d;++c){var f=b("MLegacyDataStore").get(a[c]);f&&f.userid&&b("Stratcom").hasSigil(a[c],"online-icon")&&e[f.userid]==g||b("Stratcom").hasSigil(a[c],"mobile-icon")&&e[f.userid]==h?b("DOM").show(a[c]):b("DOM").hide(a[c])}});d.listen("finally",function(a){window.clearTimeout(j),j=b("setTimeoutAcrossTransitions")(k,i)});d.send()}k()}),null);
__d("XMercuryThreadMetadataController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/mercury/thread_info/",{thread_fbids:{type:"StringVector",required:!0}})}),null);
__d("MMessagesThreadMetadataCache",["KeyedCallbackManager","MRequest","XMercuryThreadMetadataController"],(function(a,b,c,d,e,f){var g=new(b("KeyedCallbackManager"))(),h={};a={get:function(a,c){c=!g.executeOrEnqueue(a,c);if(c||h[a])return;h[a]=!0;c=new(b("MRequest"))(b("XMercuryThreadMetadataController").getURIBuilder().setStringVector("thread_fbids",[a]).getURI()).setMethod("GET");c.listen("done",function(a){if(a&&a.payload&&a.payload.threads){var b={};a.payload.threads.forEach(function(a,c,d){c=a.thread_fbid;b[c]=a});g.addResourcesAndExecute(b)}});c.listen("finally",function(){delete h[a]});c.send()}};e.exports=a}),null);
__d("MMessagesThreadImageRenderer",["cx","fbt","CSS","JSXDOM","MMessagesThreadImageRendererConfig","MMessagesThreadMetadataCache","MShortProfiles"],(function(a,b,c,d,e,f,g,h){a={participantImage:function(a,c,d){var e=b("JSXDOM").img({src:b("MMessagesThreadImageRendererConfig").profile_pic_src,alt:h._("User Profile Picture"),className:"_33zg"});c=c===58;b("CSS").conditionClass(e,"_33zg",c);b("CSS").conditionClass(e,"_508n",!c);i(a,e,c);if(d){a=b("JSXDOM").div({className:"_6_3s"});c=b("JSXDOM").div({className:"_6_3t",children:[e,a]});return c}return b("JSXDOM").div({children:[e]})},threadImage:function(a,c){var d=b("JSXDOM").img({src:b("MMessagesThreadImageRendererConfig").profile_pic_src,alt:h._("Thread picture"),className:"_33zg"});c=c===58;b("CSS").conditionClass(d,"_33zg",c);b("CSS").conditionClass(d,"_508n",!c);j(a,d);return d}};function i(a,c,d){b("MShortProfiles").get(a,function(a){a=d?a.mThumbSrcLarge:a.mThumbSrcSmall;a&&c.setAttribute("src",a)})}function j(a,c){b("MMessagesThreadMetadataCache").get(a,function(a){a=a.image_src;a&&c.setAttribute("src",a)})}e.exports=a}),null);
__d("MMessagesThreadRowID",[],(function(a,b,c,d,e,f){"use strict";var g="other_user_fbid_",h="thread_fbid_";function a(a,b,c){return a+(b?g+b:h+String(c))}f.getThreadRowID=a}),66);
__d("MSearchMessages",["DOM","Stratcom"],(function(a,b,c,d,e,f){function a(a){var c=b("DOM").listen(a,"submit",null,function(b){b.kill(),a.getElementsByTagName("button")[0].focus()});b("Stratcom").listen("m:page:unload",null,function(){c.remove(),b("Stratcom").removeCurrentListener()})}e.exports={init:a}}),null);
__d("Utf16",[],(function(a,b,c,d,e,f){function a(a){switch(a.length){case 1:return a.charCodeAt(0);case 2:return 65536|(a.charCodeAt(0)-55296)*1024|a.charCodeAt(1)-56320;default:return null}}function b(a){if(a<65536)return String.fromCharCode(a);else return String.fromCharCode(55296+(a-65536>>10))+String.fromCharCode(56320+a%1024)}f.decode=a;f.encode=b}),66);
__d("MThreadlistMessages",["cx","Bootloader","CSS","ChannelEventType","CurrentUser","DOM","HTML","MChannelManager","MDynaTemplate","MMessagesThreadDataStore","MMessagesThreadImageRenderer","MMessagesThreadRowID","MTouchChannelManager","MessengerSupportedEmoji","Stratcom","emojiAndEmote"],(function(a,b,c,d,e,f,g){"use strict";var h={_notificationListener:null,_unload:null,THREADLIST_ROW_PREFIX:"threadlist_row_",THREADLIST_ROW_ID:"threadlist_rows",THREADLIST_MESSAGE_TEXT:"threadlist-message-text",THREADLIST_ATTACHMENT_ICON:"attachment-icon",THREADLIST_REPLIED_ICON:"replied-icon",EVENT_READ:"read",_hasInitLiveUpdate:!1,initWithFlagging:function(a,b,c){this._init(a,b,!0,c)},init:function(a,b,c){this._init(a,b,!1,c)},_init:function(a,c,d,e){this._folder=a,this._enable_page_flagging=d,h._notificationListener||(h._notificationListener=b("Stratcom").listen(c,null,h.updateNotification.bind(this))),h._unload=b("Stratcom").listen("m:page:unload",null,function(){h._unload&&h._unload.remove(),h._unload=null,h._notificationListener&&h._notificationListener.remove(),h._notificationListener=null}),b("MTouchChannelManager").initialize(),e&&(this._userID=e.userID,this._pageID=e.pageID,this._shouldShowPrimInboxRedesign=Boolean(e==null?void 0:e.shouldShowPrimInboxRedesign),this._subscribeMessageType=c,this._pageID&&b("MChannelManager").subscribeIrisQueue(this._pageID,"0"),this._killDynatemplate=e.killDynatemplate)},_initLiveUpdateComponent:function(a){var c=this;b("Bootloader").loadModules(["MReactComponentRenderer","MThreadlist.react"],function(d,e){var f=b("DOM").create("div"),g={enablePageFlagging:c._enable_page_flagging,folder:c._folder,initialData:a,pageID:c._pageID,userID:c._userID,subscribeMessageType:c._subscribeMessageType};d(e,f,g);b("DOM").prependContent(h._getThreadsElement(),f)},"MThreadlistMessages")},updateNotification:function(a){a=a.getData();if(!a)return;if(a.targetFBID&&!(a.targetFBID===this._userID||a.targetFBID===this._pageID))return;if(a.mark_as_read){for(var c=0;c<a.other_user_fbids.length;c++){var d=a.other_user_fbids[c];if(a.folder_info[d]!=="inbox")continue;h._markMessageAsRead(d,null,!0)}for(c=0;c<a.thread_fbids.length;c++){d=a.thread_fbids[c];if(a.folder_info[d]!=="inbox")continue;h._markMessageAsRead(null,d,!0)}}else if(a.event==="read"&&a.is_sync)h._markMessageAsRead(a.message.other_user_fbid,a.message.thread_fbid,!0);else if(a.event===b("ChannelEventType").PAGE_THREAD_FLAG_CHANGED&&this._enable_page_flagging)h._changeThreadFlag(a.other_user_fbid.toString(),a.flagged);else if(a.parsedPayload&&a.parsedPayload.getFolder()===this._folder){d=a.targetFBID?a.targetFBID:a.realtime_viewer_fbid.toString();c=a.parsedPayload;var e=h._viewerIsAParticipant(d,c);if(!e)return;e=h._getThreadlistRowNodeID(c.getOtherUserFBID(),c.getThreadFBID());h.removeThreadRow(e);if(!this._shouldShowPrimInboxRedesign&&!this._killDynatemplate&&!c.hasWorkForeignParticipants()){c=h._createMessageMarkup(c,e,d);h.prependThreadRow(c)}else this._hasInitLiveUpdate||(this._initLiveUpdateComponent(a),this._hasInitLiveUpdate=!0)}},_viewerIsAParticipant:function(a,b){return!b.getParticipantIDs()?!1:b.getParticipantIDs().indexOf(a)>-1},_createMessageMarkup:function(a,c,d){var e,f=(e=b("DOM")).create("span",{},b("emojiAndEmote")(a.getSnippet(),{isSupportedEmoji:b("MessengerSupportedEmoji").isSupportedEmoji,getMessengerEmote:b("MessengerSupportedEmoji").getMessengerEmote}));c={id:c,href:a.getHref(),thread_name:a.getThreadNameWithUnreadCount(),time:a.getTime(),has_foreign_participants:a.hasWorkForeignParticipants()};c=b("MDynaTemplate").renderToHtml("@MThreadlistNewMessageTemplate",c);c=new(b("HTML"))(c).getRootNode();var g=e.scry(c,"*",h.THREADLIST_MESSAGE_TEXT)[0];e.replace(g,f);g=e.scry(c,"*","profile_image")[0];a.isCanonicalThread()?b("DOM").replace(g,b("MMessagesThreadImageRenderer").participantImage(a.getOtherUserFBID(),58)):a.hasThreadImage()?b("DOM").replace(g,b("MMessagesThreadImageRenderer").threadImage(a.getThreadFBID(),58)):b("DOM").replace(g,b("MMessagesThreadImageRenderer").participantImage(a.getAuthorFBID(),58));f=a.getAttachmentCount()>0;if(f){e=b("DOM").scry(c,"*",h.THREADLIST_ATTACHMENT_ICON);for(g=0;g<e.length;++g)b("DOM").show(e[g])}if(a.getAuthorFBID()==b("CurrentUser").getID()&&!a.isPageMessage()){h._markMessageNodeAsRead(c,!0);f=b("DOM").scry(c,"*",h.THREADLIST_REPLIED_ICON);for(e=0;e<f.length;++e)b("DOM").show(f[e])}this._enable_page_flagging&&a.isPageMessage()&&h._changeThreadNodeFlag(c,b("MMessagesThreadDataStore").getForFBID(d).getIsThreadFlagged(a.getOtherUserFBID(),a.getThreadFBID()));return c},_getThreadlistRowNodeID:function(a,c){return b("MMessagesThreadRowID").getThreadRowID(h.THREADLIST_ROW_PREFIX,a,c)},prependThreadRow:function(a){var c=h._getThreadsElement();c&&b("DOM").prependContent(c,a)},removeThreadRow:function(a){a=document.getElementById(a);a&&b("DOM").remove(a)},_getThreadsElement:function(){return document.getElementById(h.THREADLIST_ROW_ID)},_markMessageAsRead:function(a,b,c){a=document.getElementById(h._getThreadlistRowNodeID(a,b));h._markMessageNodeAsRead(a,c)},_markMessageNodeAsRead:function(a,c){a&&(c?b("CSS").addClass(a,"readMessage"):b("CSS").addClass(a,"unreadMessage"))},_changeThreadFlag:function(a,b){a=document.getElementById(h._getThreadlistRowNodeID(a,null));h._changeThreadNodeFlag(a,b)},_changeThreadNodeFlag:function(a,c){a&&b("CSS").conditionClass(a,"_38p7",c)}};e.exports=h}),null);